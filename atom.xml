<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>YiShao&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://dongjiang1989.github.io/"/>
  <updated>2020-01-15T03:34:29.618Z</updated>
  <id>https://dongjiang1989.github.io/</id>
  
  <author>
    <name>dongjiang1899</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CNI</title>
    <link href="https://dongjiang1989.github.io/2020/01/15/CNI/"/>
    <id>https://dongjiang1989.github.io/2020/01/15/CNI/</id>
    <published>2020-01-15T02:45:57.000Z</published>
    <updated>2020-01-15T03:34:29.618Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CNI"><a href="#CNI" class="headerlink" title="CNI"></a>CNI</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>CNI（容器网络接口）是一个规范和库，用于编写用于在Linux容器中配置网络接口的插件以及许多受支持的插件组成。</p><p>CNI包括几部分： </p><blockquote><p>golang SDK Lib, 用于集成实现网络通信接口；</p></blockquote><blockquote><p>Template，用于生成自定义的CNI插件，标准代码工程；</p></blockquote><blockquote><p>标准Document，包括社区公约、描述、roadmaps、milestone等</p></blockquote><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><h3 id="cnitool"><a href="#cnitool" class="headerlink" title="cnitool"></a>cnitool</h3><p>cnitool是将已经编译完成的的容器网络插件Adapter，添加到VM中或者PM中。</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">EnvCNIPath        = <span class="string">"CNI_PATH"</span>   <span class="comment">//CNI Adapter bin文件路径（bin的编译需要去掉ggo）</span></span><br><span class="line">EnvNetDir         = <span class="string">"NETCONFPATH"</span>  <span class="comment">//部署（添加、删除、检查）adapter需要的json配置文件路径</span></span><br><span class="line">EnvCapabilityArgs = <span class="string">"CAP_ARGS"</span>  <span class="comment">// CAP 参数</span></span><br><span class="line">EnvCNIArgs        = <span class="string">"CNI_ARGS"</span>  <span class="comment">// adapter 外部传递的参数，一般不用，将args放在json文件中</span></span><br><span class="line">EnvCNIIfname      = <span class="string">"CNI_IFNAME"</span>  <span class="comment">// 设置的容器网卡名称，如eth0</span></span><br><span class="line"></span><br><span class="line">DefaultNetDir = <span class="string">"/etc/cni/net.d"</span> <span class="comment">// 默认CNI 插件路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下部分是 插件 添加方式</span></span><br><span class="line">CmdAdd   = <span class="string">"add"</span></span><br><span class="line">CmdCheck = <span class="string">"check"</span></span><br><span class="line">CmdDel   = <span class="string">"del"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">echo `</span><br><span class="line">&#123;</span><br><span class="line">"cniVersion": "0.4.0",</span><br><span class="line">"name": "myptp",</span><br><span class="line">"type": "ptp",  //veth pair</span><br><span class="line">"ipMasq": true,</span><br><span class="line">"ipam": &#123;</span><br><span class="line">"type": "host-local",</span><br><span class="line">"subnet": "172.16.29.0/24",</span><br><span class="line">"routes": [&#123;</span><br><span class="line">"dst": "0.0.0.0/0"</span><br><span class="line">&#125;]</span><br><span class="line">&#125;</span><br><span class="line">&#125;` &gt; myptp.conflist</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Container Network Interface - networking for Linux containers
    
    </summary>
    
    
    
      <category term="K8S, Container Network Interface" scheme="https://dongjiang1989.github.io/tags/K8S-Container-Network-Interface/"/>
    
  </entry>
  
</feed>
